<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Batalla de Roedores Online</title>
<style>
body { margin:0; padding:0; font-family: 'PixelOperator', monospace; background: linear-gradient(#19191a,#04293a); color:#fff; text-align:center; }
#game-container { width:90%; max-width:900px; margin:10px auto; border-radius:12px; background:#fff8e7; color:#111; box-shadow:0 0 15px #0008; padding:15px; }
h2 { margin:10px 0; }
#battlefield { position:relative; width:100%; height:300px; background: url("fondo_bosque.png") no-repeat center center / cover; border:2px solid #000; margin-bottom:10px; border-radius:8px; overflow:hidden; }
#player,#enemy { position:absolute; bottom:20px; width:120px; image-rendering:pixelated; transition: transform 0.4s ease; z-index:5; }
#player{ left:30px; } #enemy{ right:30px; transform:scaleX(-1); }
.projectile { position:absolute; width:50px; height:50px; image-rendering:pixelated; z-index:10; }
.meditation { position:absolute; width:150px; height:150px; border-radius:50%; background:rgba(0,255,200,0.3); bottom:10px; left:0; right:0; margin:auto; z-index:4; animation:meditate 1s linear infinite; }
@keyframes meditate { 0%{ transform:scale(0.8); opacity:0.5;}50%{transform:scale(1.2); opacity:1;}100%{transform:scale(0.8); opacity:0.5;} }

.health-bar { height:20px; width:90%; max-width:500px; background:#ddd; border:2px solid #000; margin:5px auto; border-radius:8px; overflow:hidden; }
.health-fill { height:100%; background:#4caf50; width:100%; transition: width 0.3s; }

#question-container { background:#f0e68c; border:2px solid #000; border-radius:8px; padding:10px; margin-bottom:10px; }
.option { display:block; background:#fff; border:2px solid #000; border-radius:6px; padding:8px; margin:6px auto; width:90%; cursor:pointer; font-weight:bold; }
.option:hover{ background:#cde } .option:disabled{ opacity:0.6; cursor:default }
#log { background:#fff; border:2px solid #000; border-radius:6px; height:120px; overflow-y:auto; padding:5px; text-align:left; font-size:12px; color:#000; margin-bottom:10px; }
#special-button { background:#ffeb3b; border:3px solid #000; border-radius:6px; padding:8px; cursor:pointer; margin-top:5px; font-weight:bold; }
#special-button:disabled { opacity:0.6; cursor:default }

#host-panel { background:#f0f0f0; color:#000; padding:10px; border-radius:8px; margin-bottom:10px; display:none; max-height:300px; overflow-y:auto; }
#host-panel table { width:100%; border-collapse:collapse; }
#host-panel th, #host-panel td { border:1px solid #000; padding:4px; font-size:12px; text-align:center; }
#host-panel th { background:#ddd; }
#start-round-btn { background:#ff5722; color:#fff; padding:6px 12px; cursor:pointer; border:none; border-radius:6px; font-weight:bold; margin-bottom:5px; }

#energy-container { display:flex; justify-content:center; gap:6px; margin:5px auto; }
.energy-segment { width:60px; height:18px; background:#ddd; border:2px solid #000; border-radius:6px; overflow:hidden; }
.energy-fill { height:100%; width:0%; background:#00bcd4; transition: width 0.3s; }
.energy-fill.full { width:100%; background:#ffeb3b; animation: pulseEnergy 1s infinite alternate; }
@keyframes pulseEnergy { 0%{ filter:brightness(1);} 100%{ filter:brightness(1.6);} }
</style>
</head>
<body>
<div id="game-container">
<h2>Batalla de Roedores Online</h2>

<div id="host-code-container">
<p id="host-code-text">C√≥digo de sala: <span id="room-code">XXXX</span></p>
</div>

<div id="host-panel">
<button id="start-round-btn">Iniciar Ronda</button>
<table>
<thead>
<tr><th>Jugador</th><th>Equipo</th><th>Puntos</th><th>Salud</th></tr>
</thead>
<tbody id="host-table-body"></tbody>
</table>
</div>

<div id="battlefield">
<img id="player" src="" alt="Jugador">
<img id="enemy" src="" alt="Enemigo">
</div>

<div>
Puntos: <span id="score">0</span> | Tiempo: <span id="timer-display">30</span>s
</div>

<div>
<strong>Salud Jugador:</strong>
<div class="health-bar"><div id="player-health" class="health-fill"></div></div>
<strong>Salud Enemigo:</strong>
<div class="health-bar"><div id="enemy-health" class="health-fill"></div></div>
<strong>Energ√≠a:</strong>
<div id="energy-container">
<div class="energy-segment"><div id="energy1" class="energy-fill"></div></div>
<div class="energy-segment"><div id="energy2" class="energy-fill"></div></div>
<div class="energy-segment"><div id="energy3" class="energy-fill"></div></div>
</div>
</div>

<div id="question-container">
<p id="question-text"></p>
<div id="options"></div>
</div>

<button id="special-button" disabled>Habilidad Especial</button>
<div id="log"></div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket=io();
let player=null, enemy=null, currentQuestion=null, timer=null, timeLeft=30;
let score=0, playerStreak=0;

const characters=[
{name:"Ardilla Roja",img:"Ardilla roja.png",attackImg:"Ardilla_ataque.png",special:"nuez"},
{name:"Rat√≥n",img:"Raton.png",attackImg:"Raton_ataque.png",special:"doble"},
{name:"Capibara",img:"Capibara.png",attackImg:"Capibara_ataque.png",special:"meditar"}
];

const playerImg=document.getElementById("player");
const enemyImg=document.getElementById("enemy");
const playerHealthBar=document.getElementById("player-health");
const enemyHealthBar=document.getElementById("enemy-health");
const questionText=document.getElementById("question-text");
const optionsDiv=document.getElementById("options");
const scoreDisplay=document.getElementById("score");
const timerDisplay=document.getElementById("timer-display");
const specialButton=document.getElementById("special-button");
const logDiv=document.getElementById("log");
const battlefield=document.getElementById("battlefield");

const questions=[
  { q: "¬øQu√© orden de mam√≠feros es el m√°s diverso del planeta?", options: ["Carnivora", "Rodentia", "Chiroptera", "Primates"], correct: 1 },
  { q: "¬øCu√°ntas especies aproximadas de roedores existen?", options: ["500", "1.200", "2.050", "4.000"], correct: 2 },
  { q: "¬øEn qu√© continente no se encuentran los roedores de forma natural?", options: ["Asia", "Ocean√≠a", "√Åfrica", "Ant√°rtida"], correct: 3 },
  { q: "¬øCu√°l de los siguientes animales NO pertenece al orden Rodentia?", options: ["H√°mster", "Conejillo de Indias", "Murci√©lago", "Capibara"], correct: 2 },
  { q: "¬øQu√© caracter√≠stica dental distingue a los roedores?", options: ["Incisivos curvos y puntiagudos", "Dientes de crecimiento continuo", "Presencia de caninos desarrollados", "Falta total de premolares"], correct: 1 },
  { q: "¬øQu√© espacio vac√≠o se encuentra entre los incisivos y los molares?", options: ["Arco cigom√°tico", "Diastema", "Conducto dental", "Cavidad bucal"], correct: 1 },
  { q: "El capibara puede alcanzar un peso superior a:", options: ["10 kg", "25 kg", "60 kg", "100 kg"], correct: 2 },
  { q: "Los bigotes o vibrisas en los roedores sirven principalmente para:", options: ["Regular la temperatura corporal", "Detectar vibraciones y orientarse", "Masticar mejor los alimentos", "Almacenar grasa"], correct: 1 },
  { q: "¬øQu√© tipo de dieta presentan la mayor√≠a de los roedores?", options: ["Exclusivamente herb√≠vora", "Exclusivamente carn√≠vora", "Omn√≠vora", "Frug√≠vora"], correct: 2 },
  { q: "¬øCu√°l de estos roedores puede capturar peces?", options: ["Rata", "Puercoesp√≠n", "Ardilla voladora", "Capibara"], correct: 0 },
  { q: "¬øQu√© caracter√≠stica reproductiva es com√∫n en roedores?", options: ["Gestaci√≥n prolongada", "Camadas peque√±as y √∫nicas", "Reproducci√≥n frecuente con muchas cr√≠as", "Huevos con c√°scara blanda"], correct: 2 },
  { q: "En algunas especies, la vagina permanece cerrada cuando:", options: ["Est√°n pre√±adas", "No est√°n en √©poca reproductiva", "Amamantan", "Cambian de pelaje"], correct: 1 },
  { q: "¬øQu√© roedor tiene cr√≠as muy desarrolladas al nacer?", options: ["Rat√≥n", "H√°mster", "Cobayo", "Jerbo"], correct: 2 },
  { q: "¬øCu√°l es una funci√≥n ecol√≥gica destacada de los roedores?", options: ["Predar sobre mam√≠feros grandes", "Dispersar semillas", "Fijar nitr√≥geno en el suelo", "Controlar hongos"], correct: 1 },
  { q: "¬øQu√© papel cumplen los roedores como 'ingenieros del ecosistema'?", options: ["Modifican el clima", "Airean y remueven el suelo al excavar", "Controlan incendios naturales", "Polinizan √°rboles tropicales"], correct: 1 },
  { q: "Los roedores son fundamentales en las cadenas tr√≥ficas porque:", options: ["Son grandes depredadores", "Compiten con aves y reptiles", "Constituyen presas de muchos carn√≠voros", "Evitan la propagaci√≥n de plantas"], correct: 2 },
  { q: "¬øPor qu√© se consideran bioindicadores?", options: ["Por su longevidad", "Por su coloraci√≥n", "Porque reflejan el estado de los ecosistemas", "Porque migran largas distancias"], correct: 2 },
  { q: "El orden Rodentia pertenece al clado:", options: ["Xenarthra", "Laurasiatheria", "Glires", "Afrotheria"], correct: 2 },
  { q: "¬øCon qu√© otro orden comparten el clado Glires?", options: ["Lagomorpha", "Carnivora", "Primates", "Chiroptera"], correct: 0 },
  { q: "Los primeros roedores aparecieron hace aproximadamente:", options: ["250 millones de a√±os", "100 millones de a√±os", "65 millones de a√±os", "10 millones de a√±os"], correct: 2 },
  { q: "¬øQu√© evento marc√≥ el surgimiento de los primeros roedores?", options: ["Formaci√≥n de los continentes", "Extinci√≥n de los dinosaurios", "Aparici√≥n del Homo sapiens", "Glaciaci√≥n del Pleistoceno"], correct: 1 },
  { q: "El probable ancestro com√∫n de los roedores fue:", options: ["Un primate arbor√≠cola", "Un marsupial", "Un mam√≠fero insect√≠voro nocturno", "Un reptil ov√≠paro"], correct: 2 },
  { q: "¬øEn qu√© continentes se diversificaron ampliamente los roedores durante el Eoceno y Oligoceno?", options: ["√Åfrica y Ocean√≠a", "Asia y Sudam√©rica", "Europa y Norteam√©rica", "Ocean√≠a y Europa"], correct: 1 },
  { q: "¬øQu√© subfamilia de roedores muestra una radiaci√≥n adaptativa en Sudam√©rica?", options: ["Murinae", "Sigmodontinae", "Sciurinae", "Caviinae"], correct: 1 },
  { q: "Los Sciuromorfos incluyen principalmente:", options: ["Ardillas y lirones", "Ratas y ratones", "Puercoespines y capibaras", "Jerbos y tuzas"], correct: 0 },
  { q: "Los Myomorfos comprenden familias como:", options: ["Muridae y Cricetidae", "Hystricidae y Caviidae", "Castoridae y Heteromyidae", "Anomaluridae y Pedetidae"], correct: 0 },
  { q: "Los Sciurognatos tienen el √°ngulo mandibular:", options: ["Desviado lateralmente", "Alineado con los incisivos", "En forma de gancho", "En posici√≥n ventral"], correct: 1 },
  { q: "Los Histricognatos presentan el √°ngulo mandibular:", options: ["En l√≠nea recta", "Reducido", "Proyectado lateralmente", "Fijo al cr√°neo"], correct: 2 },
  { q: "¬øQu√© especie muestra cuidado parental cooperativo?", options: ["Puercoesp√≠n", "Rata topo desnuda", "Marmotas", "Jerbo"], correct: 2 },
  { q: "El rat√≥n canguro (Dipodomys spp.) destaca por:", options: ["Su vuelo planeador", "Su reflejo ultrarr√°pido frente a depredadores", "Su capacidad de almacenar agua", "Su comportamiento subterr√°neo"], correct: 1 },
  { q: "¬øQu√© funci√≥n cumplen las bolsas en las mejillas de algunos roedores?", options: ["Regular la temperatura", "Guardar alimento", "Emitir sonidos", "Transportar cr√≠as"], correct: 1 },
  { q: "¬øQu√© caracter√≠stica del pelaje es t√≠pica de las chinchillas?", options: ["Ausencia total de pelo", "Pelaje muy denso y suave", "Pelaje espinoso", "Escamas c√≥rneas"], correct: 1 },
  { q: "¬øQu√© relaci√≥n tienen los roedores con los humanos?", options: ["Ninguna", "Solo negativa, como plagas", "Negativa y positiva, seg√∫n la especie", "Exclusivamente simbi√≥tica"], correct: 2 },
];

function startTimer(){
clearInterval(timer);
timeLeft=30; timerDisplay.textContent=timeLeft;
timer=setInterval(()=>{
timeLeft--;
timerDisplay.textContent=timeLeft;
if(timeLeft<=0){
clearInterval(timer); log("‚åõ Se acab√≥ el tiempo, ambos reciben da√±o!");
player.health-=10; enemy.health-=10; updateBars(); nextQuestion();
}
},1000);
}

function nextQuestion(){
if(!questions.length) return;
const idx=Math.floor(Math.random()*questions.length);
currentQuestion=questions[idx];
questionText.textContent=currentQuestion.q;
optionsDiv.innerHTML="";
currentQuestion.options.forEach(opt=>{
const btn=document.createElement("button");
btn.className="option"; btn.textContent=opt;
btn.onclick=()=>handleAnswer(opt); optionsDiv.appendChild(btn);
});
startTimer();
}

function handleAnswer(opt){
clearInterval(timer);
if(opt===currentQuestion.a){
log("‚úÖ Correcto!"); score+=10; playerStreak++;
updateEnergy();
performAttack(player,enemy);
}else{
log("‚ùå Incorrecto!"); player.health-=15; updateBars();
}
nextQuestion();
}

function updateBars(){
playerHealthBar.style.width=player.health+"%";
enemyHealthBar.style.width=enemy.health+"%";
scoreDisplay.textContent=score;
}

function updateEnergy(){
if(playerStreak>=3){
specialButton.disabled=false;
for(let i=1;i<=3;i++) document.getElementById("energy"+i).classList.add("full");
}
}

specialButton.onclick=function(){
log("üí• Habilidad especial activada!");
playerStreak=0;
specialButton.disabled=true;
for(let i=1;i<=3;i++) document.getElementById("energy"+i).classList.remove("full");
performSpecial(player,enemy);
}

function performAttack(attacker,defender){
const atkImg=document.createElement("img"); atkImg.className="projectile";
atkImg.src=attacker.character.attackImg;
battlefield.appendChild(atkImg);
atkImg.style.left=attacker===player?"30px":"auto";
atkImg.style.right=attacker===enemy?"30px":"auto";
atkImg.style.bottom="50px";

atkImg.animate([{transform:'translateX(0)'},{transform:attacker===player?'translateX(200px)':'translateX(-200px)'}],{duration:400,fill:'forwards'});

setTimeout(()=>{
defender.health-=20; updateBars();
atkImg.remove();
},400);
}

function performSpecial(attacker,defender){
if(attacker.character.special==="nuez"){
const nut=document.createElement("img"); nut.className="projectile"; nut.src="nuez.png";
battlefield.appendChild(nut); nut.style.left="30px"; nut.style.bottom="60px";
nut.animate([{transform:'translateX(0)'},{transform:'translateX(200px)'}],{duration:600,fill:'forwards'});
setTimeout(()=>{defender.health-=35; updateBars(); nut.remove();},600);
}
if(attacker.character.special==="doble"){
performAttack(attacker,defender);
setTimeout(()=>performAttack(attacker,defender),450);
}
if(attacker.character.special==="meditar"){
const med=document.createElement("div"); med.className="meditation"; battlefield.appendChild(med);
setTimeout(()=>{attacker.health=Math.min(attacker.health+30,100); updateBars(); med.remove();},1000);
}
}

function initBattle(p,e){
player=p; enemy=e;
player.health=100; enemy.health=100; score=0; playerStreak=0;
playerImg.src=p.character.img; enemyImg.src=e.character.img;
updateBars();
nextQuestion();
}

socket.on("startBattle",data=>{initBattle(data.player,data.enemy);});
</script>
</body>
</html>
